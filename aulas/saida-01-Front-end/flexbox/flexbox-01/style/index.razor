@page "/Crud"
@rendermode InteractiveServer
@using ServerMP1.DTOs

<h3>ğŸ§ª CRUD</h3>
<p class="text-muted">CREATE - READ - UPDATE - DELETE</p>
<hr />
<div class="row col-12 container-fluid d-flex gap-5 justify-content-center">

	@* PLAYGROUND *@
	<div class="col-3 card bg-light">
		<h4 class="card-header mb-2 p-3">â• Novo Produto</h4>
		<label for="nome" class="text-muted">Nome</label>
		<input id="nome" class="mb-4 p-3 rounded border-1 col-12 form form-input" @bind="product.Name" type="text" />

		<label for="preco" class="text-muted">PreÃ§o</label>
		<input id="preco" class="mb-4 p-3 rounded border-1 col-12 form form-input" @bind="product.Price" placeholder="PreÃ§o" type="text" />

		<label for="estoque" class="text-muted">Estoque</label>
		<input id="estoque" class="mb-4 p-3 rounded border-1 col-12 form form-input" @bind="product.Stock" placeholder="Estoque" type="text" />

		<label for="categoria" class="text-muted">Categoria</label>
		<select id="categoria" class="mb-4 p-3 rounded border-1 col-12 form form-input" @bind="product.CategoryName">
			@foreach (var c in Categories)
			{
				<option>
					@c
				</option>
			}
		</select>
		<label class="@(product.IsActive? "btn-success":"btn-danger") btn mb-4 p-3 rounded border-1 col-12 form form-input d-block">
			@(product.IsActive? "Ativo":"Inativo")
			<input class="d-none" type="checkbox" @bind="product.IsActive" />
		</label>
		<div class="row d-flex justify-content-between p-3">
			<button class="mb-4 p-3 btn btn-primary border-0 rounded col-5" @onclick="SaveProduct">ğŸ’¾ Salvar</button>
			<button class="mb-4 p-3 btn btn-dark border-0 rounded col-5" @onclick="ClearProduct">ğŸ§¹ Limpar</button>
		</div>
	</div>

	@* SUMMARY *@
	<div class="col-8 card">
		<h4 class="card-header mb-2 p-3">ğŸ“‹ Lista de produtos</h4>
		<table class="table table-striped table-hover text-center	">
			<thead class="table-success p-3">
				<tr>
					<th>Id</th>
					<th>Nome</th>
					<th>PreÃ§o</th>
					<th>Estoque</th>
					<th>Categoria</th>
					<th>Ativo</th>
					<th>AÃ§Ãµes</th>
				</tr>
			</thead>
			<tbody>
				@foreach (var p in listProductsDTOs)
				{
					<tr class="text-center p-3">
						<td>@p.Id</td>
						<td>@p.Name</td>
						<td>@p.Price.ToString("c")</td>
						<td>@p.Stock</td>
						<td>@p.CategoryName</td>
						<td>@(p.IsActive ? "âœ…" : "âŒ")</td>
						<td>
							<button class="btn btn-warning border-0 rounded" @onclick="() => EditProduct(p.Id)">âœï¸ Editar</button>
							<button class="btn btn-danger border-0 rounded" @onclick="() => DeleteProduct(p.Id)">ğŸ—‘ï¸ Excluir</button>
						</td>
					</tr>
				}
			</tbody>
		</table>
	</div>
</div>

@code {
	private List<ProductDTO> listProductsDTOs = new();
	DTOs.ProductDTO product = new();
	private int IdBase = 0;
	private bool isEditing = false;
	private int editingId = 0;

	//CRIAR PRODUTO
	private void SaveProduct()
	{
		if (!isEditing)
		{
			// Criar novo
			IdBase++;
			product.Id = IdBase;
			listProductsDTOs.Add(product);
		}
		else
		{
			// Atualizar
			var item = listProductsDTOs.FirstOrDefault(x => x.Id == editingId);
			if (item != null)
			{
				item.Name = product.Name;
				item.Price = product.Price;
				item.Stock = product.Stock;
				item.CategoryName = product.CategoryName;
				item.IsActive = product.IsActive;
			}

			isEditing = false;
			editingId = 0;
		}

		// Limpar formulÃ¡rio depois
		ClearProduct();
	}


	// LIMPAR FORMULÃRIO
	private void ClearProduct()
	{
		product = new ProductDTO();
	}

	//EDITAR PRODUTO
	private void EditProduct(int id)
	{
		var item = listProductsDTOs.FirstOrDefault(x => x.Id == id);
		if (item != null)
		{
			// Copia para o formulÃ¡rio
			product = new ProductDTO
				{
					Id = item.Id,
					Name = item.Name,
					Price = item.Price,
					Stock = item.Stock,
					CategoryName = item.CategoryName,
					IsActive = item.IsActive
				};

			editingId = id;
			isEditing = true;
		}
	}

	// DELETAR PRODUTO
	private void DeleteProduct(int id)
	{
		var item = listProductsDTOs.FirstOrDefault(x => x.Id == id);
		if (item != null)
			listProductsDTOs.Remove(item);
	}


	//LISTA DE CATEGORIAS
	private List<string> Categories = new() {
		"Lanche",
		"Bebida",
		"Sobremesa",
	};
}
